

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ESMPy Regridding &mdash; OpenClimateGIS 1.0.1-next documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.1-next',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenClimateGIS 1.0.1-next documentation" href="index.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Computation" href="computation.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="examples.html" title="Examples"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="computation.html" title="Computation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">OpenClimateGIS 1.0.1-next documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="esmpy-regridding">
<span id="id1"></span><h1>ESMPy Regridding<a class="headerlink" href="#esmpy-regridding" title="Permalink to this headline">¶</a></h1>
<p>If you are unfamiliar with regridding and associated terminology, please consider perusing the website for <a class="reference external" href="https://www.earthsystemcog.org/projects/esmpy/">ESMPy</a>.</p>
<p>Example code is found in the <a class="reference internal" href="examples.html#regridding"><em>Regridding</em></a> section on the code examples page.</p>
<div class="section" id="overview-and-limitations">
<h2>Overview and Limitations<a class="headerlink" href="#overview-and-limitations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="supported-regridding-methods">
<h3>Supported Regridding Methods<a class="headerlink" href="#supported-regridding-methods" title="Permalink to this headline">¶</a></h3>
<p>If bounds are present on the source and destination grids (i.e. corners may be computed), then conservative regridding is performed. Without bounds/corners, a bilinear interpolation method is used. Bilinear is the method used when the regrid option <tt class="docutils literal"><span class="pre">’with_corners’</span></tt> is <tt class="docutils literal"><span class="pre">False</span></tt>.</p>
<dl class="docutils">
<dt>The ESMPy documentation provides an overview of regridding methods:</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="http://www.earthsystemmodeling.org/python_releases/ESMPy_620b10_04/python_doc/html/index.html#regridding-methods">http://www.earthsystemmodeling.org/python_releases/ESMPy_620b10_04/python_doc/html/index.html#regridding-methods</a></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="coordinate-systems">
<h3>Coordinate Systems<a class="headerlink" href="#coordinate-systems" title="Permalink to this headline">¶</a></h3>
<p>Currently, only spherical coordinate systems are supported. The default input/output coordinate system in OCGIS is WGS84 geographic. The WGS84 datum was chosen to maintain compatibility with GIS software and data where the WGS84 is used widely. Furthermore, there is no default datum for model/data within the CF standard.</p>
<p>All input data will be projected to the standard sphere used by PROJ4 with a semi-major axis of 6,370,997 meters (6371 kilometers). However, it is assumed data _not_ assigned a coordinate system in the file metadata _or_ when initializing a <a class="reference internal" href="api.html#ocgis.RequestDataset" title="ocgis.RequestDataset"><tt class="xref py py-class docutils literal"><span class="pre">RequestDataset</span></tt></a> has a spherical coordinate system equal to the standard sphere used by PROJ4. If the data is known to have a WGS84 datum, it may be directly assigned via:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ocgis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rd</span> <span class="o">=</span> <span class="n">ocgis</span><span class="o">.</span><span class="n">RequestDataset</span><span class="p">(</span><span class="n">uri</span><span class="o">=...</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">ocgis</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">CFWGS84</span><span class="p">())</span>
</pre></div>
</div>
<p>This will cause the software to attempt a coordinate system remap to the standard sphere. Future releases will handle more coordinate systems (i.e. planar).</p>
</div>
<div class="section" id="grid-extents">
<h3>Grid Extents<a class="headerlink" href="#grid-extents" title="Permalink to this headline">¶</a></h3>
<p>The destination grid extent must at least contain the source grid(s). The boundaries of the grids may touch.</p>
</div>
<div class="section" id="where-does-regridding-occur-in-operations">
<h3>Where does regridding occur in operations?<a class="headerlink" href="#where-does-regridding-occur-in-operations" title="Permalink to this headline">¶</a></h3>
<p>Regridding occurs following a spatial subset and before any calculations. Hence, input to calculations is the regridded data product.</p>
</div>
<div class="section" id="spatial-operations">
<h3>Spatial Operations<a class="headerlink" href="#spatial-operations" title="Permalink to this headline">¶</a></h3>
<p>Currently only the <tt class="docutils literal"><span class="pre">‘intersects’</span></tt> spatial operation is supported. If data needs to be clipped, consider first regridding the data to be clipped using an intersects spatial operation. Then feed this output data into another operation to ‘clip’.</p>
</div>
</div>
<div class="section" id="module-ocgis.regrid.base">
<span id="regridding-functions"></span><h2>Regridding Functions<a class="headerlink" href="#module-ocgis.regrid.base" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="ocgis.regrid.base.check_fields_for_regridding">
<tt class="descclassname">ocgis.regrid.base.</tt><tt class="descname">check_fields_for_regridding</tt><big>(</big><em>sources</em>, <em>destination</em>, <em>with_corners=True</em><big>)</big><a class="reference internal" href="_modules/ocgis/regrid/base.html#check_fields_for_regridding"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ocgis.regrid.base.check_fields_for_regridding" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a standard series of checks on inputs to regridding.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sources</strong> (sequence of <tt class="xref py py-class docutils literal"><span class="pre">ocgis.interface.base.field.Field</span></tt>) &#8211; Sequence of source fields to regrid.</li>
<li><strong>destination</strong> (<tt class="xref py py-class docutils literal"><span class="pre">ocgis.interface.base.field.Field</span></tt> or
<tt class="xref py py-class docutils literal"><span class="pre">ocgis.interface.base.dimension.spatial.SpatialDimension</span></tt>) &#8211; The target grid contained in a field or spatial dimension.</li>
<li><strong>with_corners</strong> (<a class="reference external" href="http://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) &#8211; If <tt class="docutils literal"><span class="pre">True</span></tt>, attempt to access corners from <tt class="docutils literal"><span class="pre">sdim</span></tt>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first"><tt class="xref py py-class docutils literal"><span class="pre">ocgis.interface.base.field.Field</span></tt></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises :</th><td class="field-body"><p class="first last">RegriddingError, CornersInconsistentError</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ocgis.regrid.base.get_esmf_grid_from_sdim">
<tt class="descclassname">ocgis.regrid.base.</tt><tt class="descname">get_esmf_grid_from_sdim</tt><big>(</big><em>sdim</em>, <em>with_corners=True</em>, <em>value_mask=None</em><big>)</big><a class="reference internal" href="_modules/ocgis/regrid/base.html#get_esmf_grid_from_sdim"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ocgis.regrid.base.get_esmf_grid_from_sdim" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an ESMF <tt class="xref py py-class docutils literal"><span class="pre">Grid</span></tt> object from an OCGIS
<tt class="xref py py-class docutils literal"><span class="pre">SpatialDimension</span></tt> object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sdim</strong> (<tt class="xref py py-class docutils literal"><span class="pre">SpatialDimension</span></tt>) &#8211; The target spatial dimension to convert into an ESMF grid.</li>
<li><strong>with_corners</strong> (<a class="reference external" href="http://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) &#8211; If <tt class="docutils literal"><span class="pre">True</span></tt>, attempt to access corners from <tt class="docutils literal"><span class="pre">sdim</span></tt>.</li>
<li><strong>value_mask</strong> (boolean <tt class="xref py py-class docutils literal"><span class="pre">numpy.array</span></tt> with same dimension as <tt class="docutils literal"><span class="pre">sdim</span></tt>) &#8211; If present, use a logical <em>or</em> operation with <tt class="docutils literal"><span class="pre">sdim</span></tt>&#8216;s mask when creating the output grid&#8217;s
mask. Values of <tt class="docutils literal"><span class="pre">True</span></tt> in <tt class="docutils literal"><span class="pre">value_mask</span></tt> are assumed to be masked.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><tt class="xref py py-class docutils literal"><span class="pre">ESMF.api.grid.Grid</span></tt></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ocgis.regrid.base.get_ocgis_field_from_esmpy_field">
<tt class="descclassname">ocgis.regrid.base.</tt><tt class="descname">get_ocgis_field_from_esmpy_field</tt><big>(</big><em>efield</em>, <em>crs=None</em>, <em>dimensions=None</em><big>)</big><a class="reference internal" href="_modules/ocgis/regrid/base.html#get_ocgis_field_from_esmpy_field"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ocgis.regrid.base.get_ocgis_field_from_esmpy_field" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>efield</strong> (<tt class="xref py py-class docutils literal"><span class="pre">ESMF.api.field.Field</span></tt>) &#8211; The ESMPy field object to convert to an OCGIS field.</li>
<li><strong>crs</strong> &#8211; The coordinate system of the ESMPy field. If <tt class="docutils literal"><span class="pre">None</span></tt>, this will default to
<tt class="xref py py-class docutils literal"><span class="pre">ocgis.crs.Spherical</span></tt>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">An OCGIS field object.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><tt class="xref py py-class docutils literal"><span class="pre">Field</span></tt></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ocgis.regrid.base.get_sdim_from_esmf_grid">
<tt class="descclassname">ocgis.regrid.base.</tt><tt class="descname">get_sdim_from_esmf_grid</tt><big>(</big><em>egrid</em>, <em>crs=None</em><big>)</big><a class="reference internal" href="_modules/ocgis/regrid/base.html#get_sdim_from_esmf_grid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ocgis.regrid.base.get_sdim_from_esmf_grid" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an OCGIS <tt class="xref py py-class docutils literal"><span class="pre">SpatialDimension</span></tt> object from an ESMF
<tt class="xref py py-class docutils literal"><span class="pre">Grid</span></tt>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>crs</strong> (<tt class="xref py py-class docutils literal"><span class="pre">ocgis.interface.base.crs.CoordinateReferenceSystem</span></tt>) &#8211; The coordinate system to attach to the output spatial dimension.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><tt class="xref py py-class docutils literal"><span class="pre">SpatialDimension</span></tt></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ocgis.regrid.base.iter_esmf_fields">
<tt class="descclassname">ocgis.regrid.base.</tt><tt class="descname">iter_esmf_fields</tt><big>(</big><em>ofield</em>, <em>with_corners=True</em>, <em>value_mask=None</em><big>)</big><a class="reference internal" href="_modules/ocgis/regrid/base.html#iter_esmf_fields"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ocgis.regrid.base.iter_esmf_fields" title="Permalink to this definition">¶</a></dt>
<dd><p>For each time coordinate, yield an ESMF <tt class="xref py py-class docutils literal"><span class="pre">Field</span></tt> from the input OCGIS Field <tt class="docutils literal"><span class="pre">ofield</span></tt>. Only
one realization and level are allowed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ofield</strong> (<tt class="xref py py-class docutils literal"><span class="pre">ocgis.interface.base.field.Field</span></tt>) &#8211; The input OCGIS Field object.</li>
<li><strong>with_corners</strong> (<a class="reference external" href="http://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) &#8211; If <tt class="docutils literal"><span class="pre">True</span></tt>, attempt to access corners from <tt class="docutils literal"><span class="pre">sdim</span></tt>.</li>
<li><strong>value_mask</strong> (boolean <tt class="xref py py-class docutils literal"><span class="pre">numpy.array</span></tt> with same dimension as <tt class="docutils literal"><span class="pre">sdim</span></tt>) &#8211; If an <tt class="xref py py-class docutils literal"><span class="pre">numpy.array</span></tt>, use a logical <em>or</em> operation with <tt class="docutils literal"><span class="pre">sdim</span></tt>&#8216;s mask when creating the
input grid&#8217;s mask. Values of <tt class="docutils literal"><span class="pre">True</span></tt> in <tt class="docutils literal"><span class="pre">value_mask</span></tt> are assumed to be masked. If <tt class="docutils literal"><span class="pre">None</span></tt> is provided (the
default) then the mask will be set using the first realization/time/level from the first variable contained in
<tt class="docutils literal"><span class="pre">ofield</span></tt>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">tuple(int, str, <tt class="xref py py-class docutils literal"><span class="pre">ESMF.api.field.Field</span></tt>)</p>
</td>
</tr>
</tbody>
</table>
<p>The returned tuple elements are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="5%" />
<col width="28%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Index</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>int</td>
<td>The time coordinate index in <tt class="docutils literal"><span class="pre">ofield</span></tt> being converted to an ESMF Field.</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>str</td>
<td>The alias of the variable currently being converted.</td>
</tr>
<tr class="row-even"><td>2</td>
<td><tt class="xref py py-class docutils literal"><span class="pre">Field</span></tt></td>
<td>The ESMF Field object.</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Raises :</th><td class="field-body">AssertionError</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="ocgis.regrid.base.iter_regridded_fields">
<tt class="descclassname">ocgis.regrid.base.</tt><tt class="descname">iter_regridded_fields</tt><big>(</big><em>sources</em>, <em>destination</em>, <em>with_corners='choose'</em>, <em>value_mask=None</em><big>)</big><a class="reference internal" href="_modules/ocgis/regrid/base.html#iter_regridded_fields"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ocgis.regrid.base.iter_regridded_fields" title="Permalink to this definition">¶</a></dt>
<dd><p>Regrid <tt class="docutils literal"><span class="pre">sources</span></tt> to match the grid of <tt class="docutils literal"><span class="pre">destination</span></tt>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sources</strong> (sequence of <tt class="xref py py-class docutils literal"><span class="pre">ocgis.interface.base.field.Field</span></tt>) &#8211; Sequence of source fields to regrid.</li>
<li><strong>destination</strong> (<tt class="xref py py-class docutils literal"><span class="pre">ocgis.interface.base.field.Field</span></tt> or
<tt class="xref py py-class docutils literal"><span class="pre">ocgis.interface.base.dimension.spatial.SpatialDimension</span></tt>) &#8211; The target grid contained in a field or spatial dimension.</li>
<li><strong>with_corners</strong> (<em>str or bool</em>) &#8211; If <tt class="docutils literal"><span class="pre">'choose'</span></tt>, automatically determine if corners should be used. They will be used if they
are available on all <tt class="docutils literal"><span class="pre">sources</span></tt> and the <tt class="docutils literal"><span class="pre">destination</span></tt>. If <tt class="docutils literal"><span class="pre">True</span></tt>, attempt to access corners from <tt class="docutils literal"><span class="pre">sdim</span></tt>
raising an exception if corners are not available. If <tt class="docutils literal"><span class="pre">False</span></tt>, do not use corners.</li>
<li><strong>value_mask</strong> (boolean <tt class="xref py py-class docutils literal"><span class="pre">numpy.array</span></tt> with same dimension as <tt class="docutils literal"><span class="pre">sdim</span></tt>) &#8211; If an <tt class="xref py py-class docutils literal"><span class="pre">numpy.array</span></tt>, use a logical <em>or</em> operation with <tt class="docutils literal"><span class="pre">sdim</span></tt>&#8216;s mask when creating the
input grid&#8217;s mask. Values of <tt class="docutils literal"><span class="pre">True</span></tt> in <tt class="docutils literal"><span class="pre">value_mask</span></tt> are assumed to be masked. If <tt class="docutils literal"><span class="pre">None</span></tt> is provided (the
default) then the mask will be set using the first realization/time/level from the first variable contained in
<tt class="docutils literal"><span class="pre">ofield</span></tt>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><tt class="xref py py-class docutils literal"><span class="pre">ocgis.interface.base.field.Field</span></tt></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">ESMPy Regridding</a><ul>
<li><a class="reference internal" href="#overview-and-limitations">Overview and Limitations</a><ul>
<li><a class="reference internal" href="#supported-regridding-methods">Supported Regridding Methods</a></li>
<li><a class="reference internal" href="#coordinate-systems">Coordinate Systems</a></li>
<li><a class="reference internal" href="#grid-extents">Grid Extents</a></li>
<li><a class="reference internal" href="#where-does-regridding-occur-in-operations">Where does regridding occur in operations?</a></li>
<li><a class="reference internal" href="#spatial-operations">Spatial Operations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-ocgis.regrid.base">Regridding Functions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="computation.html"
                        title="previous chapter">Computation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="examples.html"
                        title="next chapter">Examples</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/regrid.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="examples.html" title="Examples"
             >next</a></li>
        <li class="right" >
          <a href="computation.html" title="Computation"
             >previous</a> |</li>
        <li><a href="index.html">OpenClimateGIS 1.0.1-next documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, University of Michigan-Ann Arbor, Michigan Technological University, University of Colorado-Boulder.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>